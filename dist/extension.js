(()=>{"use strict";var e={d:(o,n)=>{for(var a in n)e.o(n,a)&&!e.o(o,a)&&Object.defineProperty(o,a,{enumerable:!0,get:n[a]})},o:(e,o)=>Object.prototype.hasOwnProperty.call(e,o),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},o={};e.r(o),e.d(o,{activate:()=>d});const n=require("vscode"),a=require("child_process"),r=require("path");var t=n.window.createOutputChannel("Pandoc");function i(e,o){var a=e+" ["+o+"] "+(new Date).toLocaleTimeString();n.window.setStatusBarMessage(a,1500)}function d(e){var o=n.workspace.getConfiguration("pandoc").get("defaultOutputFormat").length>0?n.workspace.getConfiguration("pandoc").get("defaultOutputFormat"):void 0,a=n.commands.registerCommand("pandoc.render",(e=>{const a=n.window.activeTextEditor;if(!a)return;let t=r.normalize(a.document.fileName);var i=r.dirname(t),d=r.basename(t),p=r.parse(d).name;o||(null==e?void 0:e.outputType)?(null==e?void 0:e.outputType)&&!o||(null==e?void 0:e.outputType)?c(i,d,p,e.outputType):o&&!(null==e?void 0:e.outputType)&&c(i,d,p,o):function(e,o,a){let r=[];r.push({label:"pdf",description:"Render as pdf document"}),r.push({label:"docx",description:"Render as word document"}),r.push({label:"html",description:"Render as html document"}),r.push({label:"asciidoc",description:"Render as asciidoc document"}),r.push({label:"docbook",description:"Render as docbook document"}),r.push({label:"epub",description:"Render as epub document"}),r.push({label:"rst",description:"Render as rst document"}),n.window.showQuickPick(r).then((n=>{n&&c(e,o,a,n.label)}))}(i,d,p)}));e.subscriptions.push(a)}function c(e,o,d,c){var p,u,s,g,l,k,f=r.join(e,o).replace(/(^.*$)/gm,'"$1"'),b=(r.join(e,d)+"."+c).replace(/(^.*$)/gm,'"$1"');i("Generating",c);var w=function(e){var o;switch(e){case"pdf":o=n.workspace.getConfiguration("pandoc").get("pdfOptString");break;case"docx":o=n.workspace.getConfiguration("pandoc").get("docxOptString");break;case"html":o=n.workspace.getConfiguration("pandoc").get("htmlOptString");break;case"asciidoc":o=n.workspace.getConfiguration("pandoc").get("asciidocOptString");break;case"docbook":o=n.workspace.getConfiguration("pandoc").get("docbookOptString");break;case"epub":o=n.workspace.getConfiguration("pandoc").get("epubOptString");break;case"rst":o=n.workspace.getConfiguration("pandoc").get("rstOptString")}return o}(c),v=function(){var e;return n.workspace.getConfiguration("pandoc").has("executable")&&""!==n.workspace.getConfiguration("pandoc").get("executable")&&(e=n.workspace.getConfiguration("pandoc").get("executable")),e}(),m=n.workspace.getConfiguration("pandoc"),h=null!==(u=null===(p=m.inspect("useDocker"))||void 0===p?void 0:p.globalValue)&&void 0!==u?u:void 0;void 0!==h&&(t.append('migrating global configuration "pandoc.useDocker" -> "pandoc.docker.enabled"\n'),n.window.showWarningMessage('pandoc: found deprecated value in global configuration. Migrating configuration "pandoc.useDocker" -> "pandoc.docker.enabled".'),m.update("docker.enabled",h,n.ConfigurationTarget.Global),m.update("useDocker",void 0,n.ConfigurationTarget.Global));var C=null!==(g=null===(s=m.inspect("useDocker"))||void 0===s?void 0:s.workspaceValue)&&void 0!==g?g:void 0;void 0!==C&&(t.append('migrating workspace configuration "pandoc.useDocker" -> "pandoc.docker.enabled"\n'),n.window.showWarningMessage('pandoc: found deprecated value in workspace configuration. Migrating configuration "pandoc.useDocker" -> "pandoc.docker.enabled".'),m.update("docker.enabled",C,n.ConfigurationTarget.Workspace),m.update("useDocker",void 0,n.ConfigurationTarget.Workspace));var S=null!==(k=null===(l=m.inspect("useDocker"))||void 0===l?void 0:l.workspaceFolderValue)&&void 0!==k?k:void 0;void 0!==S&&(t.append('migrating folder configuration "pandoc.useDocker" -> "pandoc.docker.enabled"\n'),n.window.showWarningMessage('pandoc: found deprecated value in folder configuration. Migrating configuration "pandoc.useDocker" -> "pandoc.docker.enabled".'),m.update("docker.enabled",S,n.ConfigurationTarget.WorkspaceFolder),m.update("useDocker",void 0,n.ConfigurationTarget.WorkspaceFolder));var x=m.get("docker.enabled"),O=m.get("docker.options"),T=m.get("docker.image"),$=x?`docker run --rm -v "${e}:/data" ${O} ${T} "${o}" -o "${d}.${c}" ${w}`:`"${v}" ${f} -o ${b} ${w}`;(0,a.exec)($,{cwd:e},(function(e,o,r){null!==o&&t.append(o.toString()+"\n"),null!==r&&""!==r&&(n.window.showErrorMessage("stderr: "+r.toString()),t.append("stderr: "+r.toString()+"\n")),null!==e?(n.window.showErrorMessage("exec error: "+e),t.append("exec error: "+e+"\n")):n.workspace.getConfiguration("pandoc").get("render.openViewer")&&(i("Launching",c),function(e){switch(process.platform){case"darwin":(0,a.exec)("open "+e);break;case"linux":(0,a.exec)("xdg-open "+e);break;default:(0,a.exec)(e)}}(b))}))}module.exports=o})();